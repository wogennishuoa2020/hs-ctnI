<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高敏肌钙蛋白I判读辅助手册</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /********************************************
         * 修复代码问题的关键CSS修改
         *******************************************/
        
        /* 1. 全局容器 - 限制最大宽度并添加两侧留白 */
        .global-container {
            max-width: 1200px; /* Increased max-width for more space */
            margin: 0 auto;
            padding: 0 50px; /* Increased side padding for more breathing room on large screens */
        }
        
        /* 2. 修复标题大小问题 */
        /* Targets the h1 directly inside the header-content */
        .header-content h1 {
            font-size: 32.4px; /* Adjusted: 36px * 0.9 = 32.4px */
            margin-bottom: 10px;
            font-weight: 700; /* Ensure main title is bold */
            line-height: 1.2; /* Added for readability */
        }
        /* Targets the subtitle class directly */
        .subtitle {
            font-size: 19.44px; /* Adjusted: 21.6px * 0.9 = 19.44px */
            font-weight: 500; /* Keep subtitle slightly lighter than main title */
            opacity: 0.9;
            margin-bottom: 0.8rem; /* Adjusted margin */
            letter-spacing: 0.5px; /* Retain letter spacing */
        }
        /* Targets the header-description class */
        .header-description {
            font-size: 12.96px; /* Adjusted: 14.4px * 0.9 = 12.96px */
            opacity: 0.8;
            max-width: 800px; /* Limit width for better readability */
        }
        
        /* 3. 内容容器添加呼吸感 */
        .app-container {
            display: grid; /* Ensure grid display for the main content area */
            grid-template-columns: 4fr 3fr; /* Default two columns for larger screens */
            gap: 30px; /* 增加块间距 */
            margin-top: 40px; /* 增加上边距 */
            margin-bottom: 40px; /* 增加下边距 */
        }
        
        /* 4. 卡片增加内边距和圆角提供空间感 */
        .analysis-section,
        .result-section,
        .guide-section {
            background: white; /* Retain white background for these sections */
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 30px;
        }
        
        /* 5. 输入/输出元素增加呼吸空间 */
        .form-group {
            margin-bottom: 28px;
        }
        .radio-group {
            gap: 16px;
            margin-top: 15px;
        }
        
        /********************************************
         * 原始关键样式（保留好的部分）
         *******************************************/
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans SC', 'Inter', sans-serif; /* Prioritize Noto Sans SC for Chinese, fallback to Inter */
        }
        
        :root {
            /* 颜色变量 */
            --primary-blue: #1a73e8;
            --light-blue: #e6f7ff;
            --dark-blue: #0056b3;
            --red: #e53935;
            --orange: #ff9800;
            --yellow: #fdd835;
            --green: #43a047;
            --gray: #f5f5f5;
            --dark-gray: #333;
            --border: #ddd;
            --white: #ffffff;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        body {
            background-color: var(--light-blue);
            color: var(--dark-gray);
            line-height: 1.6;
            padding: 25px 0; /* Adjusted padding for body */
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            padding: 35px 0; /* Adjusted padding for header */
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 25px;
            justify-content: flex-start; /* Ensure default left alignment for desktop */
            padding-left: 30px; /* Added padding to create distance from left edge for logo */
        }
        
        .header-text {
            flex: 1; /* Allow header-text to take available space, pushing content left */
        }

        .logo {
            width: 90px;
            height: 90px;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0; /* Ensure no auto-margins for desktop left alignment */
        }
        
        .logo i {
            font-size: 42px;
            color: white;
        }
        
        /* Analysis section title */
        .section-title {
            color: var(--primary-blue);
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            background: var(--light-blue);
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .section-title h2 {
            font-weight: 700;
        }

        /* Form elements */
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .unit-wrapper {
            position: relative;
            display: flex;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        input.invalid, select.invalid {
            border-color: var(--red);
            box-shadow: 0 0 0 2px rgba(229, 57, 53, 0.2);
        }
        
        .unit {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .small-text {
            font-size: 13px;
            color: #777;
            margin-top: 8px;
            font-weight: 300;
        }
        
        .radio-item {
            flex: 1;
            min-width: 140px;
        }
        
        .radio-label {
            display: block;
            padding: 14px;
            background: var(--gray);
            border-radius: 12px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            font-size: 15px;
        }
        
        .radio-label:hover {
            border-color: var(--primary-blue);
            background: rgba(26, 115, 232, 0.05);
        }
        
        input[type="radio"]:checked + .radio-label {
            border-color: var(--primary-blue);
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary-blue);
            font-weight: 500;
        }
        
        input[type="radio"] {
            display: none;
        }
        
        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .checkbox-item {
            flex: 1;
            min-width: 150px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--gray);
            border-radius: 10px;
            cursor: pointer;
        }
        
        .btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
        }
        
        .btn:hover {
            background: var(--dark-blue);
        }
        
        /* 步骤2：结果解读区域优化 */
        .result-card {
            border-radius: 16px;
            padding: 20px; /* Reduced padding */
            text-align: center;
            transition: var(--transition);
            transform: translateY(10px);
            opacity: 0;
            visibility: hidden;
            position: relative;
        }
        
        .result-card.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .card-icon {
            width: 60px; /* Reduced icon size */
            height: 60px; /* Reduced icon size */
            margin: 0 auto 15px; /* Reduced margin */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 30px; /* Reduced icon font size */
            color: white;
        }
        
        .red-bg { background-color: var(--red); }
        .orange-bg { background-color: var(--orange); }
        .yellow-bg { background-color: var(--yellow); }
        .green-bg { background-color: var(--green); }
        
        .result-title {
            font-size: 22px; /* Reduced font size */
            font-weight: 700;
            margin-bottom: 10px; /* Reduced margin */
        }
        
        .risk-level {
            display: inline-block;
            font-weight: 700;
            padding: 4px 12px; /* Reduced padding */
            border-radius: 16px; /* Adjusted border radius */
            margin-bottom: 15px; /* Reduced margin */
            font-size: 14px; /* Reduced font size */
        }
        
        .value-highlight {
            font-size: 18px; /* Reduced font size */
            font-weight: 700;
            margin: 10px 0; /* Reduced margin */
            padding: 8px; /* Reduced padding */
            border-radius: 10px; /* Adjusted border radius */
            background: rgba(0,0,0,0.04);
        }
        
        .rec-title {
            font-size: 18px;
            color: var(--primary-blue);
            margin-bottom: 15px;
            margin-top: 25px;
            text-align: left;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .rec-box {
            background: var(--light-blue);
            border-left: 4px solid var(--primary-blue);
            border-radius: 0 8px 8px 0;
            padding: 18px;
            margin-bottom: 15px;
            text-align: left;
        }
        
        .rec-list {
            margin-left: 25px;
        }
        
        .rec-list li {
            margin-bottom: 8px;
            padding-left: 5px;
        }
        
        .reference-box {
            background: #f9f9f9;
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .ref-list li {
            margin-bottom: 10px;
        }
        
        .graph-container {
            height: 180px; /* Reduced graph height */
            position: relative;
            margin: 15px 0; /* Reduced margin */
            background: #f9f9f9;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .chart-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px 5px; /* Reduced padding */
        }
        
        .chart-line {
            border-top: 1px dashed rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            padding: 0 8px; /* Reduced padding */
            font-size: 11px; /* Reduced font size */
            color: #777;
        }
        
        .guide-section {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-top: 25px;
        }
        
        .guide-title {
            background: linear-gradient(to right, var(--primary-blue), var(--dark-blue));
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 20px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .guide-content {
            margin-bottom: 25px;
        }
        
        .guide-box {
            background: #f0f8ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .guide-steps {
            margin: 15px 0 15px 25px;
        }
        
        .guide-steps li {
            margin-bottom: 15px;
        }
        
        .guide-key {
            font-weight: 700;
            color: var(--primary-blue);
            display: inline-block;
            margin-right: 5px;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: #777;
            font-size: 14px;
            margin-top: 25px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 14px 24px;
            background: var(--gray);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .tab.active {
            background: var(--primary-blue);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Collapsible (Details/Summary) styles */
        details {
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
        }

        details[open] {
            background-color: #e6f7ff; /* Light blue when open */
            border-color: var(--primary-blue);
        }
        
        summary {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 18px;
            color: var(--dark-gray);
            cursor: pointer;
            outline: none;
            position: relative;
            list-style: none; /* Hide default marker */
        }

        summary::-webkit-details-marker {
            display: none; /* Hide default marker for webkit browsers */
        }
        summary::marker {
            display: none; /* Hide default marker for other browsers */
        }

        summary::after {
            content: "\f078"; /* Unicode for chevron-down icon from FontAwesome */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 20px;
            transition: transform 0.3s ease;
            color: var(--primary-blue);
        }

        details[open] summary::after {
            transform: rotate(180deg);
        }

        .details-content {
            padding: 10px 20px 20px;
            border-top: 1px solid var(--border);
        }
        
        /* Disclaimer Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            max-height: 90vh; /* Limit height to prevent overflow */
            overflow-y: auto; /* Enable scrolling for long content */
            position: relative;
            margin: 1rem; /* Add margin for smaller screens */
        }
        @media (max-width: 767px) {
            .modal-content {
                padding: 1.5rem; /* Reduced padding on mobile */
                margin: 0.5rem; /* Smaller margin on very small screens */
            }
        }
        .modal-content h2 {
            font-size: 1.75rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-gray);
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        .modal-content p, .modal-content li {
            color: #666666; /* Medium gray */
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }
        .modal-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }
        .modal-buttons button {
            background-color: var(--primary-blue);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
        }
        .modal-buttons button:hover {
            background-color: var(--dark-blue);
        }
        .hidden {
            display: none;
        }

        /* Responsive adjustments */
        @media (min-width: 992px) {
            .header-content {
                text-align: left; /* Ensure text aligns left within its container */
                padding: 0 30px; /* Added padding to create distance from left edge for logo */
            }
            .header-content h1 {
                flex: 1; /* Allows h1 to take available space */
                text-align: left; /* Ensure h1 text is left-aligned */
            }
            .logo {
                margin: 0; /* Remove auto margins for larger screens */
                width: 80px; /* Adjusted logo size for larger screens */
                height: 80px;
            }
            .app-container {
                grid-template-columns: 1fr 1fr; /* Two columns for larger screens */
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px 0; /* Reduced body padding for mobile */
            }
            .header-content {
                justify-content: center; /* Center items when they wrap on small screens */
                text-align: center; /* Center text within the header-text div on small screens */
                padding: 0 15px; /* Added padding for mobile header content */
            }
            .logo {
                margin-bottom: 15px; /* Add bottom margin when stacked */
                margin-left: auto; /* Center horizontally when stacked */
                margin-right: auto; /* Center horizontally when stacked */
            }
            .header-content h1 {
                font-size: 25.92px; /* Adjusted: 28.8px * 0.9 = 25.92px */
            }
            .subtitle {
                font-size: 16.2px; /* Adjusted: 18px * 0.9 = 16.2px */
            }
            .global-container {
                padding: 0 15px; /* Reduced side padding for mobile */
            }
            .header-description { /* Mobile header description size */
                font-size: 11.34px; /* Adjusted: 12.6px * 0.9 = 11.34px */
            }
            .logo { /* Mobile logo size */
                width: 70px;
                height: 70px;
            }
            .logo i { /* Mobile logo icon size */
                font-size: 35px;
            }
            header { /* Mobile header padding */
                padding: 25px 0;
            }
            .section-title { /* Mobile section title size */
                font-size: 22px;
            }
            .app-container { /* Ensure single column on mobile */
                grid-template-columns: 1fr;
            }
            /* Adjustments for result card on mobile */
            .result-card {
                padding: 15px;
            }
            .card-icon {
                width: 50px;
                height: 50px;
                font-size: 25px;
                margin-bottom: 10px;
            }
            .result-title {
                font-size: 20px;
                margin-bottom: 8px;
            }
            .risk-level {
                font-size: 12px;
                padding: 3px 10px;
                margin-bottom: 10px;
            }
            .value-highlight {
                font-size: 16px;
                margin: 8px 0;
                padding: 6px;
            }
            .graph-container {
                height: 150px;
                margin: 10px 0;
            }
            .chart-lines {
                padding: 5px;
            }
            .chart-line {
                font-size: 10px;
                padding: 0 5px;
            }
        }
        /* Further adjustments for very small screens as per DeepSeek's suggestion */
        @media (max-width: 480px) {
            .radio-item {
                min-width: 100%; /* Ensure radio items stack on very small screens */
            }
        }
    </style>
</head>
<body>
    <div id="disclaimerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>使用须知及免责声明</h2>
            <p class="text-center text-red-600 font-bold mb-4">重要提示：请在使用本工具前仔细阅读以下条款。使用本工具即表示您已阅读、理解并同意以下内容。</p>

            <h3>1. 工具定位：</h3>
            <p>《高敏肌钙蛋白I判读辅助手册》（以下简称“本工具”）仅为信息参考工具，旨在为医护人员提供基于国内指南的辅助信息。本工具不构成医疗诊断、治疗建议或医疗服务，不能替代专业医生的临床判断。</p>

            <h3>2. 使用限制：</h3>
            <p>本工具仅供医护人员参考使用，不得用于患者直接操作或自诊自治。用户应结合患者具体病情、完整病史、体格检查及其他检查结果进行综合判断。</p>

            <h3>3. 责任免除：</h3>
            <p>本工具提供的所有信息均基于公开的国内指南（如《心肌肌钙蛋白实验室检测与临床应用中国专家共识》），但不保证其准确性、完整性或适用性。使用本工具所导致的任何后果（包括但不限于误诊、延误治疗、医疗事故），本工具开发者及提供者不承担任何法律责任。</p>

            <h3>4. 数据隐私：</h3>
            <p>本工具可能存储用户输入的数据（存储于本地设备）。请勿输入患者真实姓名、身份证号等敏感信息。本工具开发者不对数据泄露或不当使用承担责任。建议定期清除浏览器缓存以保护隐私。</p>

            <h3>5. 知识产权声明：</h3>
            <p>本工具引用了国内相关指南内容，仅用于学术参考，未经商业用途。如有版权争议，请联系我们处理。</p>

            <h3>6. 适用法律：</h3>
            <p>本声明受中华人民共和国法律管辖。如发生争议，双方应协商解决；协商不成的，提交开发者所在地有管辖权的人民法院处理。</p>

            <h3>7. 最终解释权：</h3>
            <p>本工具开发者保留对本工具及声明的最终解释权。</p>

            <div class="modal-buttons">
                <button id="acceptDisclaimer">我已阅读并同意</button>
            </div>
        </div>
    </div>

    <div class="global-container" id="mainContent">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="header-text">
                    <h1>高敏肌钙蛋白I判读辅助手册</h1>
                    <div class="subtitle">基层医院快速判读与决策工具</div>
                    <p class="header-description">本工具基于中国最新指南共识，为检测阳性结果提供标准化处理路径</p>
                </div>
            </div>
        </header>

        <div class="app-container">
            <div class="analysis-section">
                <div class="section-title">
                    <i class="fas fa-calculator"></i>
                    <h2>快速判读分析</h2>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="step1">步骤1：输入数据</div>
                    <div class="tab" data-tab="step2">步骤2：结果解读</div>
                    <div class="tab" data-tab="step3">步骤3：处理建议</div>
                </div>
                
                <div id="step1" class="tab-content active">
                    <div class="form-group">
                        <label for="customReferenceInterval">自定义参考区间 (99th URL, ng/mL)</label>
                        <div class="unit-wrapper">
                            <input type="number" id="customReferenceInterval" step="0.001" placeholder="例如: 0.060 (默认)">
                            <div class="unit">ng/mL</div>
                        </div>
                        <div class="small-text">请根据您所在医院的实际参考区间填写，留空则使用默认值 0.060 ng/mL</div>
                    </div>

                    <div class="form-group">
                        <label for="initialTnI">首次肌钙蛋白检测值 (hs-cTnI, ng/mL) <span class="text-red-500">*</span></label>
                        <div class="unit-wrapper">
                            <input type="number" id="initialTnI" step="0.001" placeholder="输入首次hs-cTnI检测结果">
                            <div class="unit">ng/mL</div>
                        </div>
                        <div class="small-text">当前参考区间上限: ≤<span id="currentRefIntervalDisplay">0.060</span> ng/mL</div>
                    </div>

                    <div class="form-group">
                        <label for="repeatTnI">复查肌钙蛋白检测值 (hs-cTnI, ng/mL)</label>
                        <div class="unit-wrapper">
                            <input type="number" id="repeatTnI" step="0.001" placeholder="例如: 0.090 (可选)">
                            <div class="unit">ng/mL</div>
                        </div>
                        <div class="small-text">若无复查，可留空</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="repeatTime">复查时间间隔</label>
                        <select id="repeatTime">
                            <option value="1">1 小时</option>
                            <option value="2">2 小时</option>
                            <option value="3">3 小时</option>
                        </select>
                        <div class="small-text">从首次检测到复查的时间间隔</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="chestPainDuration">胸痛持续时间 (小时) <span class="text-red-500">*</span></label>
                        <div class="unit-wrapper">
                            <input type="number" id="chestPainDuration" step="0.1" placeholder="例如: 4">
                            <div class="unit">小时</div>
                        </div>
                        <div class="small-text">从胸痛发作到首次就诊的时间长度</div>
                    </div>
                    
                    <div class="form-group">
                        <label>患者症状特点 <span class="text-red-500">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="symptoms" id="symp-typical" value="typical">
                                <label class="radio-label" for="symp-typical">典型心绞痛<br><small>（压迫感，持续>20min）</small></label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="symptoms" id="symp-atypical" value="atypical">
                                <label class="radio-label" for="symp-atypical">不典型胸痛</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="symptoms" id="symp-other" value="other">
                                <label class="radio-label" for="symp-other">其他伴随症状<br><small>（呼吸困难、晕厥、大汗、恶心呕吐）</small></label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="symptoms" id="symp-none" value="none">
                                <label class="radio-label" for="symp-none">无明显症状</label>
                            </div>
                        </div>
                        <div class="small-text">"不典型"可能指刺痛、短暂、非心前区等特点</div>
                    </div>
                    
                    <div class="form-group">
                        <label>心电图结果 <span class="text-red-500">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="ecg" id="ecg-st" value="st_elevation">
                                <label class="radio-label" for="ecg-st">ST段抬高（或新发左/右束支传导阻滞）</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="ecg" id="ecg-ischemic" value="ischemic_changes">
                                <label class="radio-label" for="ecg-ischemic">缺血性改变（ST段压低、T波倒置等）</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="ecg" id="ecg-normal" value="normal">
                                <label class="radio-label" for="ecg-normal">正常或非特异性改变</label>
                            </div>
                        </div>
                        <div class="small-text">LBBB = 左束支传导阻滞</div>
                    </div>
                    
                    <div class="form-group">
                        <label>患者高危因素（可多选，无则不选）</label>
                        <div class="checkbox-row">
                            <div class="checkbox-item">
                                <input type="checkbox" id="risk-diabetes" value="diabetes">
                                <label class="checkbox-label" for="risk-diabetes">糖尿病/肾病</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="risk-cad" value="cad_history">
                                <label class="checkbox-label" for="risk-cad">既往冠心病史</label>
                            </div>
                             <div class="checkbox-item">
                                <input type="checkbox" id="risk-age" value="age">
                                <label class="checkbox-label" for="risk-age">年龄>65岁</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="risk-multiple" value="multiple_risk">
                                <label class="checkbox-label" for="risk-multiple">多个心血管危险因素</label>
                            </div>
                        </div>
                        <div class="small-text">危险因素越多，心肌损伤可能性越大</div>
                    </div>
                    
                    <button id="analyze-btn" class="btn"><i class="fas fa-play-circle"></i> 开始分析</button>
                </div>
                
                <div id="step2" class="tab-content">
                    <div class="result-card" id="result-card">
                        <div class="card-icon" id="result-icon-bg">
                            <i id="result-icon" class="fas fa-check"></i>
                        </div>
                        <h3 class="result-title" id="result-title">等待分析结果</h3>
                        <div class="risk-level" id="risk-level">风险等级：-</div>
                        
                        <div class="value-highlight" id="tni-value">
                            肌钙蛋白值：
                        </div>
                        
                        <div class="graph-container">
                            <div class="chart-lines">
                                <div class="chart-line">
                                    <span>高值</span><span>>10倍ULN</span>
                                </div>
                                <div class="chart-line">
                                    <span>中值</span><span>3-10倍ULN</span>
                                </div>
                                <div class="chart-line">
                                    <span>低值</span><span>1-3倍ULN</span>
                                </div>
                                <div class="chart-line" style="border-color: var(--green);">
                                    <span>正常</span><span>≤ULN</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="step3" class="tab-content">
                    <div class="rec-title">
                        <i class="fas fa-stethoscope"></i> 处理措施
                    </div>
                    <div class="rec-box">
                        <div id="rec-recommendations">
                            <p>请输入患者信息后获取针对性建议</p>
                        </div>
                    </div>
                    
                    <div class="rec-title">
                        <i class="fas fa-book"></i> 诊断依据
                    </div>
                    <div class="reference-box">
                        <ul id="diagnosis-reasoning">
                            <li>等待结果分析...</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="result-section">
                <div class="section-title">
                    <i class="fas fa-book-medical"></i>
                    <h2>解读手册</h2>
                </div>
                
                <div class="guide-section">
                    <div class="guide-title">
                        <i class="fas fa-info-circle"></i> 核心解读原则
                    </div>
                    
                    <div class="guide-content">
                        <details>
                            <summary><h3>1. 参考值理解</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p><span class="guide-key">单位说明：</span>本系统使用 ng/mL 作为肌钙蛋白单位（1 ng/mL = 1000 ng/L）</p>
                                    <p><span class="guide-key">99th URL：</span>诊断心肌损伤的阈值（可自定义）。超过此值为"阳性"。</p>
                                    <p><span class="guide-key">不同升高分级：</span>
                                        <ul class="guide-steps">
                                            <li><strong>正常:</strong> ≤ <span id="detailedRefIntervalDisplay">0.060</span> ng/mL</li>
                                            <li><strong>轻度升高:</strong> > <span id="detailedRefIntervalDisplay2">0.060</span> ng/mL，但 < 2-3 倍 99th URL</li>
                                            <li><strong>中度升高:</strong> 2-3 倍 99th URL，但 < 10 倍 99th URL</li>
                                            <li><strong>显著升高:</strong> ≥ 10 倍 99th URL</li>
                                        </ul>
                                    </p>
                                </div>
                            </div>
                        </details>
                        
                        <details>
                            <summary><h3>2. 检测结果意义</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>hs-cTnI阳性不能简单等同于急性心肌梗死（AMI）：</p>
                                    <ul class="guide-steps">
                                        <li>可能是急性心肌梗死（AMI）</li>
                                        <li>也可能是慢性心肌损伤（肾功能不全、心衰等）</li>
                                        <li>关键区分点为"急性变化"</li>
                                    </ul>
                                    <p><span class="guide-key">动态监测原则：</span>建议0h、1h、2h/3h检测，观察变化趋势。</p>
                                </div>
                            </div>
                        </details>
                        
                        <details>
                            <summary><h3>3. 基层医院处理要点</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <ul class="guide-steps">
                                        <li><strong>关键检查：</strong>心电图 + hs-cTnI是最低要求。</li>
                                        <li><strong>典型胸痛+ST抬高：</strong>立即启动STEMI流程。</li>
                                        <li><strong>hs-cTnI显著升高+典型症状：</strong>按AMI处理，联系转诊。</li>
                                        <li><strong>hs-cTnI轻度升高+心电图正常：</strong>寻找其他原因。</li>
                                        <li><strong>不确定情况：</strong>动态监测或转诊。</li>
                                    </ul>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
                
                <div class="guide-section">
                    <div class="guide-title">
                        <i class="fas fa-book"></i> 详细流程
                    </div>
                    <div class="guide-content">
                        <details>
                            <summary><h3>1. 初始评估 (5-10 分钟内)</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>快速、准确的初始评估是后续诊疗的关键。此阶段应在5-10分钟内完成，重点在于识别危急重症并获取关键病史和检查信息。</p>
                                    <p><span class="guide-key">快速分诊：</span>识别危急重症患者，优先处理。</p>
                                    <ul class="guide-steps">
                                        <li><strong>重点关注：</strong></li>
                                        <li>持续性剧烈胸痛，伴大汗、恶心、呕吐等</li>
                                        <li>呼吸困难、晕厥、休克</li>
                                        <li>心电图 ST 段抬高</li>
                                    </ul>
                                    <p><span class="guide-key">详细病史：</span></p>
                                    <ul class="guide-steps">
                                        <li><strong>胸痛特点：</strong></li>
                                        <li>部位、性质、放射部位</li>
                                        <li>发作时间、持续时间</li>
                                        <li>诱发因素、缓解因素</li>
                                        <li><strong>危险因素：</strong></li>
                                        <li>年龄、性别、高血压、糖尿病、吸烟、高血脂、冠心病史等</li>
                                        <li><strong>伴随症状：</strong></li>
                                        <li>呼吸困难、心悸、恶心、呕吐、出汗、晕厥等</li>
                                        <li><strong>既往史：</strong></li>
                                        <li>有无其他心血管疾病、肾脏疾病等</li>
                                    </ul>
                                    <p><span class="guide-key">12 导联心电图：</span>10 分钟内完成，重点观察：</p>
                                    <ul class="guide-steps">
                                        <li>ST 段抬高或压低</li>
                                        <li>T 波改变</li>
                                        <li>Q 波</li>
                                        <li>新的左束支传导阻滞</li>
                                    </ul>
                                    <p class="small-text">**注：** 18导联心电图是在标准12导联基础上增加右胸导联（V3R、V4R）和后壁导联（V7、V8、V9），有助于更全面评估右心室或心肌后壁梗死等情况。</p>
                                    <p><span class="guide-key">初步体格检查：</span></p>
                                    <ul class="guide-steps">
                                        <li>生命体征：血压、心率、呼吸、体温、氧饱和度</li>
                                        <li>心脏听诊：有无杂音、奔马律等</li>
                                        <li>肺部听诊：有无啰音等</li>
                                    </ul>
                                    <p><span class="guide-key">hs-cTnI 检测：</span>立即检测，并记录检测时间。</p>
                                    <p><span class="guide-key">初步风险评估：</span>根据病史、心电图、体格检查结果，初步判断患者发生ACS和其他严重疾病的可能性。</p>
                                    <p class="small-text">**指南依据:** “所有急诊接诊的急性非创伤性胸痛患者，均应进行病史采集、体格检查及心电图（electrocardiogram, ECG）检查（首次医疗接触10 min内，18导联）。综合临床信息后，高效且有针对性地使用生物标志物检测，有助于及时作出正确的诊断和治疗决策。” — 《急性非创伤性胸痛生物标志物联合检测专家共识（2024版）》</p>
                                    <p class="small-text">**首次医疗接触定义：** 指患者因当前症状（如胸痛）首次获得医疗专业人员（如急救人员、医生、护士）评估或干预的时间点，不限于首次就诊医院。</p>
                                </div>
                            </div>
                        </details>

                        <details>
                            <summary><h3>2. hs-cTnI 结果解读</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>正确解读hs-cTnI结果对于诊断至关重要。请结合患者临床情况和动态变化进行综合判断。</p>
                                    <p><span class="guide-key">参考范围：</span></p>
                                    <ul class="guide-steps">
                                        <li>以医院建立的 <strong>99th URL</strong> 为准，同时参考试剂盒说明书。</li>
                                        <li><span class="small-text">**注解：** `99th URL` 指的是“第99百分位上参考限值”（99th percentile Upper Reference Limit），是健康人群中该指标的正常上限，超过此值可能提示心肌损伤。</span></li>
                                        <li><span class="small-text">例如：本工具默认参考区间为 ≤ 0.060 ng/mL</span></li>
                                    </ul>
                                    <p><span class="guide-key">结果分级：</span></p>
                                    <ul class="guide-steps">
                                        <li><strong>正常:</strong> ≤ 99th URL</li>
                                        <li><strong>升高:</strong> > 99th URL
                                            <ul class="guide-steps">
                                                <li><strong>轻度升高:</strong> > 99th URL，但 < 2-3 倍 99th URL</li>
                                                <li><strong>中度升高:</strong> 2-3 倍 99th URL，但 < 10 倍 99th URL</li>
                                                <li><strong>显著升高:</strong> ≥ 10 倍 99th URL</li>
                                            </ul>
                                        </li>
                                    </ul>
                                    <p class="small-text">**指南依据:** “hs-cTn检测方法应当满足在超过50%健康男性和女性人群外周血中均能够稳定地检测到cTn，且检测的结果等于或高于检出限，同时第99百分位浓度下CV≤10%，否则为con-cTn检测方法。” — 《心肌肌钙蛋白实验室检测与临床应用中国专家共识》</p>
                                    <p class="small-text">“cTn水平高于99th URL是心肌损伤的诊断标准，如伴随着上升或下降（≥20%）为急性心肌损伤；如持续升高，且幅度变化<20%则为慢性心肌损伤。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                </div>
                            </div>
                        </details>

                        <details>
                            <summary><h3>3. 动态监测</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>动态监测hs-cTnI的变化趋势对于鉴别诊断AMI具有重要价值。建议遵循推荐的复查时间和次数，并结合变化值进行判断。</p>
                                    <p><span class="guide-key">复查时间：</span>建议在以下时间点进行动态监测：</p>
                                    <ul class="guide-steps">
                                        <li><strong>首选方案:</strong> 0 小时（首次检测）、1 小时、2 小时</li>
                                        <li><strong>备选方案:</strong> 0 小时（首次检测）、2 小时、3 小时 (尤其适用于基层医院)</li>
                                    </ul>
                                    <p><span class="guide-key">复查次数：</span>至少复查 1-2 次，必要时可多次复查。</p>
                                    <p><span class="guide-key">结果解读：</span></p>
                                    <ul class="guide-steps">
                                        <li><strong>绝对变化 (Δ值):</strong> 复查值 - 首次值</li>
                                        <li><strong>相对变化 (%):</strong> ((复查值 - 首次值) / 首次值) × 100%</li>
                                    </ul>
                                    <p><span class="guide-key">判断标准：</span></p>
                                    <ul class="guide-steps">
                                        <li><strong>AMI 高可能性:</strong>
                                            <ul class="guide-steps">
                                                <li>任何一次 hs-cTnI ≥ 10 倍 99th URL</li>
                                                <li>或 1 小时 Δ值 ≥ 0.050 ng/mL，或相对变化 ≥ 20%</li>
                                                <li>或 2 小时 Δ值 ≥ 0.010 ng/mL，或相对变化 ≥ 30%</li>
                                                <li>或 3 小时 Δ值 ≥ 0.015 ng/mL，或相对变化 ≥ 50%</li>
                                            </ul>
                                        </li>
                                        <li><strong>AMI 可能性小:</strong> 所有 hs-cTnI ≤ 2-3 倍 99th URL，且动态变化不明显</li>
                                        <li><strong>需要进一步观察:</strong> 介于上述两者之间的情况</li>
                                    </ul>
                                    <p class="small-text">**指南依据:** “hs-cTn的最大应用价值一是通过极低值（通常采用LoD或LoQ）安全排除NSTEMI，二是通过高的基线值或单位时间变化值快速诊断NSTEMI。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                    <p class="small-text">“0~1h快速CDP主要有两个理论基础：第一，hs-cTn的测定值是一个连续变量，hs-cTn值的升高直接反映了心肌梗死概率的增大；第二，hs-cTn早期的改变量可以作为3h至6h改变量的替代，并额外提供独立于0h测定值的诊断和预后价值。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                </div>
                            </div>
                        </details>

                        <details>
                            <summary><h3>4. 其他检查建议</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>除了hs-cTnI和心电图，其他辅助检查对于全面评估病情、排除其他疾病也十分重要。在基层医院，请根据医保限制和患者意愿，优先考虑必要的检查。</p>
                                    <p><span class="guide-key">必备检查：</span></p>
                                    <ul class="guide-steps">
                                        <li>12 导联心电图（用于初步评估和排除STEMI）</li>
                                    </ul>
                                    <p><span class="guide-key">选择性检查（根据临床指征和基层条件选择）：</span></p>
                                    <ul class="guide-steps">
                                        <li><strong>胸片:</strong> 排除气胸、肺部感染等非心源性胸痛原因，费用较低，易于基层开展。</li>
                                        <li><strong>D-二聚体:</strong> 怀疑肺栓塞（PE）时，D-二聚体阴性可有效排除PE，避免不必要的CT检查。</li>
                                        <li><strong>心脏超声:</strong> 评估心功能、室壁运动等，对鉴别心源性疾病有帮助，但费用较高，可根据患者具体情况和转诊需求决定。</li>
                                        <li><strong>肾功能:</strong> 排除肾功能不全，因为肾功能不全可能导致hs-cTnI慢性升高。</li>
                                        <li><strong>血常规、电解质、血糖等:</strong> 根据具体情况选择，用于排除其他系统性疾病或评估并发症。</li>
                                    </ul>
                                    <p class="small-text">**指南依据:** “PE的明确诊断依赖于增强CT检查，而D-二聚体对疑似PE的急性胸痛患者，尤其是临床可能性低到中的患者具有较高的诊断和排除诊断的价值。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                    <p class="small-text">“AAS的确诊及后续治疗方案的选择依赖于以增强CT为代表的影像学检查结果，但增强CT的应用受到临床可行性、造影剂使用和电离辐射等因素的制约。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                </div>
                            </div>
                        </details>

                        <details>
                            <summary><h3>5. 处理决策</h3></summary>
                            <div class="details-content">
                                <div class="guide-box">
                                    <p>根据综合评估结果，采取相应的处理决策。早期识别高危患者并及时转诊是改善预后的关键。</p>
                                    <p><span class="guide-key">危急重症（已在“快速筛查”中处理）:</span></p>
                                    <ul class="guide-steps">
                                        <li>立即抢救，并联系上级医院转诊。</li>
                                        <li>例如：急性主动脉夹层、张力性气胸、急性肺栓塞伴休克。</li>
                                    </ul>
                                    <p><span class="guide-key">高度怀疑 STEMI:</span></p>
                                    <ul class="guide-steps">
                                        <li>立即启动 STEMI 处理流程：吸氧、建立静脉通路、监测心电；给予抗血小板、抗凝等治疗（具体用药请遵医嘱）；尽快转诊上级医院行急诊 PCI。</li>
                                    </ul>
                                    <p><span class="guide-key">高度怀疑 NSTEMI（高敏肌钙蛋白高可能性）:</span></p>
                                    <ul class="guide-steps">
                                        <li>密切监测患者病情变化。给予抗血小板、抗凝等治疗（具体用药请遵医嘱）。评估患者风险，决定是否需要转诊上级医院行冠脉造影。</li>
                                    </ul>
                                    <p><span class="guide-key">AMI 可能性小（高敏肌钙蛋白低可能性）:</span></p>
                                    <ul class="guide-steps">
                                        <li>寻找其他可能的原因，并进行相应处理。例如：心绞痛 (给予对症治疗，具体用药请遵医嘱)，心肌炎 (给予对症治疗，具体用药请遵医嘱)，肺栓塞 (给予对症治疗，具体用药请遵医嘱)。</li>
                                    </ul>
                                    <p><span class="guide-key">诊断不明确（高敏肌钙蛋白需进一步观察）:</span></p>
                                    <ul class="guide-steps">
                                        <li>密切观察患者病情变化。复查 hs-cTnI 和心电图。必要时请上级医院会诊。</li>
                                    </ul>
                                    <p class="small-text">**指南依据:** 本手册目标在于提供分层处理策略，强调对危急重症的早期识别和及时转诊，并对病情较轻的患者提供基层观察和治疗建议。</p>
                                    <p class="small-text">“除STEMI和极高危NSTE-ACS患者需尽快实施再灌注治疗外，其他急性胸痛患者均需依靠cTn检测结果诊断或者排除心肌损伤与ACS。” — 《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="guide-section">
            <div class="guide-title" style="background: #666;">
                <i class="fas fa-exclamation-triangle"></i> 重要提示
            </div>
            <div class="reference-box">
                <p><strong>1. 工具定位：</strong>本工具是基于国内最新指南共识(如《心肌肌钙蛋白实验室检测与临床应用中国专家共识》、《急性非创伤性胸痛生物标志物联合检测专家共识》、《胸痛中心规范化应用主要心血管生物标志物专家共识》等)开发的辅助决策工具，<strong>不能替代专业医生的临床判断</strong>。</p>
                <p><strong>2. 实际诊疗</strong>实际诊疗需结合患者完整病史、体格检査、其他实验室检査及影像学结果。基层医院条件有限时，应优先保证患者安全，及时转诊。</p>
                <p><strong>3. 参考值：</strong>hs-cTn 的 99th URL 应以医院自身建立的为准，本工具默认使用<strong>0.060 ng/mL</strong>作为判断依据，您可以在上方*自定义参考区间*。</p>
            </div>
        </div>
        
        <footer>
            <p>高敏肌钙蛋白I判读辅助手册 v1.3 &copy; <span id="currentYear"></span> | 基于中国最新临床指南共识</p>
            <p>本工具仅供医务人员参考，实际诊疗需结合患者具体情况</p>
        </footer>
    </div>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Disclaimer Modal Elements
        const disclaimerModal = document.getElementById('disclaimerModal');
        const acceptDisclaimerButton = document.getElementById('acceptDisclaimer');
        const mainContent = document.getElementById('mainContent');

        // Check if disclaimer has been accepted
        const hasAcceptedDisclaimer = localStorage.getItem('disclaimerAccepted');

        if (hasAcceptedDisclaimer === 'true') {
            mainContent.classList.remove('hidden');
            disclaimerModal.classList.add('hidden');
        } else {
            mainContent.classList.add('hidden');
            disclaimerModal.classList.remove('hidden');
        }

        // Event listener for accepting the disclaimer
        acceptDisclaimerButton.addEventListener('click', () => {
            localStorage.setItem('disclaimerAccepted', 'true');
            disclaimerModal.classList.add('hidden');
            mainContent.classList.remove('hidden');
            // Scroll to the top of the main content after accepting
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });


        // Tab切换功能
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // 移除所有active状态
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // 添加当前active状态
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Result display elements
        const resultCard = document.getElementById('result-card');
        const resultTitle = document.getElementById('result-title');
        const riskLevel = document.getElementById('risk-level');
        const resultIcon = document.getElementById('result-icon');
        const resultIconBg = document.getElementById('result-icon-bg'); // For background color
        const tniValueDisplay = document.getElementById('tni-value');
        const recRecommendations = document.getElementById('rec-recommendations');
        const diagnosisReasoning = document.getElementById('diagnosis-reasoning'); 

        // Input elements
        const customReferenceIntervalInput = document.getElementById('customReferenceInterval');
        const initialTnIInput = document.getElementById('initialTnI');
        const repeatTnIInput = document.getElementById('repeatTnI');
        const repeatTimeSelect = document.getElementById('repeatTime');
        const chestPainDurationInput = document.getElementById('chestPainDuration');
        const symptomsRadios = document.querySelectorAll('input[name="symptoms"]');
        const ecgRadios = document.querySelectorAll('input[name="ecg"]'); 
        const riskFactorCheckboxes = document.querySelectorAll('.checkbox-row input[type="checkbox"]');

        const currentRefIntervalDisplay = document.getElementById('currentRefIntervalDisplay');
        const detailedRefIntervalDisplay = document.getElementById('detailedRefIntervalDisplay');
        const detailedRefIntervalDisplay2 = document.getElementById('detailedRefIntervalDisplay2'); // For "轻度升高" in guide

        // Default reference interval
        const DEFAULT_URL_99_PERCENTILE_NG_ML = 0.060; 

        // Function to get the current 99th percentile URL, either custom or default
        function get99thPercentileURL() {
            const customValue = parseFloat(customReferenceIntervalInput.value);
            if (!isNaN(customValue) && customValue > 0) {
                return customValue;
            }
            return DEFAULT_URL_99_PERCENTILE_NG_ML;
        }

        // Update the displayed reference interval when the custom input changes
        customReferenceIntervalInput.addEventListener('input', () => {
            const currentURL = get99thPercentileURL();
            currentRefIntervalDisplay.textContent = currentURL.toFixed(3);
            detailedRefIntervalDisplay.textContent = currentURL.toFixed(3);
            detailedRefIntervalDisplay2.textContent = currentURL.toFixed(3);
        });

        // Initialize displayed reference interval on load
        document.addEventListener('DOMContentLoaded', () => {
            const initialURL = get99thPercentileURL();
            currentRefIntervalDisplay.textContent = initialURL.toFixed(3);
            detailedRefIntervalDisplay.textContent = initialURL.toFixed(3);
            detailedRefIntervalDisplay2.textContent = initialURL.toFixed(3);
        });


        // Function to calculate elevation level based on 99th URL (ULN)
        function calculateElevationLevel(value, ULN) {
            if (value <= ULN) return 'normal';
            if (value <= ULN * 3) return 'mild'; // 1-3 times ULN
            if (value <= ULN * 10) return 'moderate'; // 3-10 times ULN
            return 'significant'; // >10 times ULN
        }

        // Function to get descriptive text for elevation level
        function getElevationText(level, value, ULN) {
            switch(level) {
                case 'normal': return `hs-cTnI: <strong>${value.toFixed(3)} ng/mL</strong> (正常范围)`;
                case 'mild': return `hs-cTnI: <strong>${value.toFixed(3)} ng/mL</strong> (轻度升高，约1-3倍ULN)`;
                case 'moderate': return `hs-cTnI: <strong>${value.toFixed(3)} ng/mL</strong> (中度升高，约3-10倍ULN)`;
                case 'significant': return `hs-cTnI: <strong>${value.toFixed(3)} ng/mL</strong> (显著升高，>10倍ULN)`;
                default: return '';
            }
        }

        // Main analysis function
        document.getElementById('analyze-btn').addEventListener('click', analyzeResults);

        function analyzeResults() {
            // Reset invalid state for all inputs
            initialTnIInput.classList.remove('invalid');
            repeatTnIInput.classList.remove('invalid');
            chestPainDurationInput.classList.remove('invalid');
            customReferenceIntervalInput.classList.remove('invalid');
            symptomsRadios.forEach(radio => radio.nextElementSibling.classList.remove('invalid')); // Remove invalid class from labels
            ecgRadios.forEach(radio => radio.nextElementSibling.classList.remove('invalid'));


            // Get input values
            const initialTnI = parseFloat(initialTnIInput.value);
            const repeatTnI = parseFloat(repeatTnIInput.value); // May be NaN if empty
            const repeatTime = parseInt(repeatTimeSelect.value);
            const chestPainDuration = parseFloat(chestPainDurationInput.value);
            const ULN = get99thPercentileURL(); // Get the current (custom or default) ULN


            let selectedSymptoms = '';
            for (const radio of symptomsRadios) {
                if (radio.checked) {
                    selectedSymptoms = radio.value;
                    break;
                }
            }

            let selectedEcg = '';
            for (const radio of ecgRadios) {
                if (radio.checked) {
                    selectedEcg = radio.value;
                    break;
                }
            }

            const selectedRiskFactors = Array.from(riskFactorCheckboxes)
                                            .filter(cb => cb.checked)
                                            .map(cb => cb.value);

            // Input validation
            let isValid = true;
            const errors = [];

            if (isNaN(initialTnI) || initialTnI < 0) {
                initialTnIInput.classList.add('invalid');
                errors.push("请填写有效的首次 hs-cTnI 数值。");
                isValid = false;
            }
            if (!isNaN(repeatTnI) && repeatTnI < 0) { // Only validate if a value is entered
                repeatTnIInput.classList.add('invalid');
                errors.push("复查 hs-cTnI 数值不能为负。");
                isValid = false;
            }
            if (isNaN(chestPainDuration) || chestPainDuration < 0) {
                chestPainDurationInput.classList.add('invalid');
                errors.push("请填写有效的胸痛持续时间。");
                isValid = false;
            }
            if (!selectedSymptoms) {
                symptomsRadios.forEach(radio => radio.nextElementSibling.classList.add('invalid'));
                errors.push("请选择胸痛症状特点。");
                isValid = false;
            }
            if (!selectedEcg) {
                ecgRadios.forEach(radio => radio.nextElementSibling.classList.add('invalid'));
                errors.push("请选择心电图结果。");
                isValid = false;
            }
            const customRefValue = customReferenceIntervalInput.value.trim();
            if (customRefValue !== '' && (isNaN(parseFloat(customRefValue)) || parseFloat(customRefValue) <= 0)) {
                customReferenceIntervalInput.classList.add('invalid');
                errors.push("自定义参考区间若填写，请确保为有效正数。");
                isValid = false;
            }


            if (!isValid) {
                alert("请检查以下问题：\n" + errors.join("\n"));
                return;
            }

            let diagnosis = "";
            let urgency = "";
            let colorClass = ""; // This will be the string like 'red-bg', 'orange-bg', etc.
            let actions = []; // Corresponds to "处理措施"
            let reasons = []; // Corresponds to "诊断依据"
            
            const elevationLevel = calculateElevationLevel(initialTnI, ULN);

            // Decision Logic
            // Priority 1: Immediate life-threatening conditions (STEMI or severe symptoms)
            if (selectedEcg === 'st_elevation' || selectedSymptoms === 'other') {
                diagnosis = '高度怀疑危急重症';
                urgency = '立即处理';
                colorClass = 'red-bg';
                actions = [
                    '立即启动紧急救治流程：吸氧、建立静脉通路、持续心电监护，监测生命体征。',
                    '紧急联系上级医院或胸痛中心，准备转运。',
                    '转运过程中给予初步对症支持治疗（具体用药请遵医嘱）。',
                    '对于STEMI，需在60分钟内启动再灌注治疗（PCI或溶栓）。'
                ];
                reasons = [
                    `心电图提示ST段抬高或新发左/右束支传导阻滞，或患者伴有呼吸困难、晕厥、大汗、恶心呕吐等严重伴随症状。`,
                    `高度提示危急重症（如STEMI、急性肺栓塞、主动脉夹层等）。`,
                    `依据《急性非创伤性胸痛生物标志物联合检测专家共识（2024版）》，需快速鉴别并及时转诊。`
                ];
            } 
            // Priority 2: Initial TnI normal or very low, and low clinical suspicion
            else if (initialTnI <= ULN) { // Initial TnI normal
                if (chestPainDuration > 3 && selectedRiskFactors.length === 0 && selectedEcg === 'normal' && selectedSymptoms === 'none') {
                    diagnosis = '急性心肌梗死可能性很小';
                    urgency = '观察随访';
                    colorClass = 'green-bg';
                    actions = [
                        '建议观察患者，寻找其他可能原因（如肌肉骨骼痛、消化道疾病等）。',
                        '若症状持续或加重，可考虑复查 hs-cTnI。',
                        '无需立即进行高费用检查。'
                    ];
                    reasons = [
                        `首次 hs-cTnI ${initialTnI.toFixed(3)} ng/mL (≤ ${ULN.toFixed(3)} ng/mL, 小于99th URL阈值)。`,
                        `且胸痛持续时间较长（>3小时）、无高危因素、心电图正常、胸痛不典型。`,
                        `依据《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》，在无心脏症状患者中，此值可安全排除急性心肌梗死。`
                    ];
                } else {
                    diagnosis = '肌钙蛋白正常，需结合临床';
                    urgency = '观察随访';
                    colorClass = 'green-bg';
                    actions = [
                        '建议观察患者，若症状持续或加重，或临床高度怀疑 ACS，可考虑复查 hs-cTnI。',
                        '结合病史、心电图等综合判断。'
                    ];
                    reasons = [
                        `首次 hs-cTnI ${initialTnI.toFixed(3)} ng/mL (≤ ${ULN.toFixed(3)} ng/mL, 正常范围)。`,
                        `但仍需结合临床情况。依据《心肌肌钙蛋白实验室检测与临床应用中国专家共识》，肌钙蛋白正常不完全排除ACS，尤其在症状发作早期，可能尚未达到升高水平，需结合临床综合判断。`
                    ];
                }
            } 
            // Priority 3: Initial TnI elevated, dynamic changes are key
            else { // Initial TnI Elevated (> ULN)
                let isAMIHighPossibility = false;
                let isNonAcuteInjury = false; // For chronic elevation or non-acute causes

                if (repeatTnI !== null && !isNaN(repeatTnI)) { // Dynamic evaluation available
                    const deltaValue = repeatTnI - initialTnI;
                    const relativeChange = initialTnI !== 0 ? (deltaValue / initialTnI) * 100 : 0;

                    // Apply dynamic change criteria from your provided logic
                    if (repeatTime === 1) {
                        if (relativeChange >= 20 || deltaValue >= 0.050) isAMIHighPossibility = true;
                        else if (relativeChange < 20 && deltaValue < 0.050 && initialTnI <= (3 * ULN) && repeatTnI <= (3 * ULN)) isNonAcuteInjury = true;
                    } else if (repeatTime === 2) {
                        if (relativeChange >= 30 || deltaValue >= 0.010) isAMIHighPossibility = true;
                        else if (relativeChange < 30 && deltaValue < 0.010 && initialTnI <= (3 * ULN) && repeatTnI <= (3 * ULN)) isNonAcuteInjury = true;
                    } else if (repeatTime === 3) {
                        if (relativeChange >= 50 || deltaValue >= 0.015) isAMIHighPossibility = true;
                        else if (relativeChange < 50 && deltaValue < 0.015 && initialTnI <= (3 * ULN) && repeatTnI <= (3 * ULN)) isNonAcuteInjury = true;
                    }
                }

                // Also check for absolute high values as a primary high possibility
                if (initialTnI >= (10 * ULN) || (repeatTnI !== null && !isNaN(repeatTnI) && repeatTnI >= (10 * ULN))) {
                     isAMIHighPossibility = true; // Overrides dynamic changes if absolute value is very high
                }

                // Combine with symptoms and ECG for NSTEMI suspicion
                if (isAMIHighPossibility || (selectedSymptoms === 'typical' && selectedEcg === 'ischemic_changes')) {
                    diagnosis = '高度怀疑急性心肌梗死（AMI）';
                    urgency = '立即处理';
                    colorClass = 'red-bg';
                    actions = [
                        '立即启动初步对症支持治疗（如抗血小板、抗凝等，具体用药请遵医嘱）。',
                        '密切监测患者生命体征和心电图。',
                        '评估患者风险，紧急联系上级医院心内科，准备转诊行冠脉造影。'
                    ];
                    reasons = [
                        `心电图提示ST段抬高或新发左/右束支传导阻滞，或患者伴有呼吸困难、晕厥、大汗、恶心呕吐等严重伴随症状。`,
                        `高度提示危急重症（如STEMI、急性肺栓塞、主动脉夹层等）。`,
                        `依据《急性非创伤性胸痛生物标志物联合检测专家共识（2024版）》，需快速鉴别并及时转诊。`
                    ];
                } else if (isNonAcuteInjury) {
                    diagnosis = '肌钙蛋白升高，非急性心肌损伤';
                    urgency = '观察随访';
                    colorClass = 'green-bg';
                    actions = [
                        '寻找其他可能原因（如肾功能不全、心肌炎、心力衰竭、肺栓塞等），并针对病因进行相应处理。',
                        '若临床高度怀疑 ACS，仍需密切观察或请上级医院会诊。'
                    ];
                    reasons = [
                        `hs-cTnI 升高但动态变化不显著。`,
                        `依据《心肌肌钙蛋白实验室检测与临床应用中国专家共识》，高敏肌钙蛋白升高可能由非ACS原因引起，如慢性肾病、心力衰竭、心肌炎等。此时肌钙蛋白水平通常稳定或动态变化不明显。`
                    ];
                } else {
                    diagnosis = '肌钙蛋白升高，诊断不明确';
                    urgency = '进一步检查';
                    colorClass = 'orange-bg';
                    actions = [
                        '建议密切观察患者病情变化，必要时再次复查 hs-cTnI。',
                        '结合其他检查（如心脏超声、肾功能、D-二聚体等）综合判断。',
                        '若症状加重，立即转诊。'
                    ];
                    reasons = [
                        `hs-cTnI 升高，但动态变化处于观察区间，或临床表现不典型，诊断仍不明确。`,
                        `依据《胸痛中心规范化应用主要心血管生物标志物专家共识（2024）》，对于肌钙蛋白动态变化不明确的患者，需要结合更长时间的观察、重复检测以及其他临床证据进行综合判断。`
                    ];
                }
            }

            // Update Result Display
            resultCard.className = `result-card show ${colorClass}`;
            resultTitle.textContent = diagnosis;
            riskLevel.textContent = `风险等级: ${urgency}`;
            resultIconBg.className = `card-icon ${colorClass}`; // Update icon background color
            resultIcon.className = `fas ${
                colorClass === 'red-bg' ? 'fa-bolt' :
                colorClass === 'orange-bg' ? 'fa-exclamation-circle' :
                colorClass === 'yellow-bg' ? 'fa-exclamation-triangle' :
                'fa-check'
            }`; // Update icon based on color

            tniValueDisplay.innerHTML = getElevationText(elevationLevel, initialTnI, ULN);
            
            recRecommendations.innerHTML = actions.map(rec => `<p>${rec}</p>`).join('');
            diagnosisReasoning.innerHTML = reasons.map(reason => `<li>${reason}</li>`).join('');
            
            // Auto switch to result tab
            document.querySelector('[data-tab="step2"]').click();
            
            // Auto switch to treatment advice tab after 10 seconds
            setTimeout(() => {
                document.querySelector('[data-tab="step3"]').click();
            }, 10000);
        }
    </script>
</body>
</html>
